[{"name":"Clearout Hosts","type":"shell","order":1,"config":{"content":"","shell":"rm -f /srv/ssot-auto/ansible/inventory/guest-*"},"createdAt":"2026-01-17T07:29:21.4147799Z"},{"name":"Generate Inventory","type":"template","order":2,"config":{"content":"","eachEntity":"true","path":"/srv/ssot-auto/ansible/inventory/guest-{{ entity.Name }}.yml","template":"{{ fields = entity.Fields }}\n\n# Group Assignement\n{{ groups = fields.groups ?? [] }}\nlxd_guests:\n  hosts:\n    {{ fields.hostname }}:\n{{ for g in groups }}\n{{ g }}:\n  hosts:\n    {{ fields.hostname }}:\n{{ end }}\n\n# Host Vars\nall:\n  hosts:\n    {{ fields.hostname }}:\n      id: {{ entity.id }}\n{{~ if fields.hostvars != null ~}}\n{{ \"      \" + ((\"\" + fields.hostvars) | string.replace \"\\n\" \"\\n      \") }}\n{{~ end ~}}\n    # Overwrites\n{{~ if fields.guest_lxc_image != null ~}}\n      guest_lxc_image: {{ fields.guest_lxc_image }}\n{{~ end ~}}\n\n\n{{ if fields.backup == \"false\" || fields.backup == false}}\n      backup: false\n{{ else }}\n      backup: true\n{{ end }}\n\n{{~ if fields.backup != null ~}}\n      backup: {{ fields.backup }}\n{{~ end ~}}\n\n{{ if fields.os_update_reboot == \"false\" || fields.os_update_reboot == false}}\n      os_update_reboot: deny\n{{ end }}\n\n{{ if fields.terraform == \"false\" || fields.terraform == false}}\n      terraform: false\n{{ else }}\n      terraform: true\n{{ end }}\n\n{{~ if fields.motd_environment != null ~}}\n      motd_environment: {{ fields.motd_environment }}\n      environment: {{ fields.motd_environment }}\n{{~ end ~}}\n\n{{~ if fields.motd_description != null ~}}\n      motd_description: {{ fields.motd_description }}\n{{~ end ~}}\n\n{{~ if fields.motd_tags != null ~}}\n      motd_tags:\n{{ for t in fields.motd_tags }}\n        - {{ t }}\n{{ end }}\n{{~ end ~}}\n\n{{~ if fields.guest_static_ip != null ~}}\n      guest_static_ip: {{ fields.guest_static_ip }}\n{{~ end ~}}\n\n{{ ingress = fields.ingress }}\n{{ if ingress != null && ingress.size > 0 }}\n      traefik_ingress:\n{{ for item in ingress }}\n{{ pair = (\"\" + item) | string.split \":\" }}\n{{ if pair.size == 2 }}\n      - route: Host(`{{ pair[0] }}`)\n        target: http://{{ fields.hostname }}:{{ pair[1] }}\n{{ end }}\n{{ end }}\n{{ end }}\n"}}]